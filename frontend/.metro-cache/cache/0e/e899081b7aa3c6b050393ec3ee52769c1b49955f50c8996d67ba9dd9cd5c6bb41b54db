{"dependencies":[{"name":"./commons.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":21,"index":182},"end":{"line":5,"column":44,"index":205}}],"key":"BsP1rur2s8tExOXn4/1q3+2ZDEY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.encodePacket = void 0;\n  exports.encodePacketToBinary = encodePacketToBinary;\n  const commons_js_1 = require(_dependencyMap[0], \"./commons.js\");\n  const withNativeBlob = typeof Blob === \"function\" || typeof Blob !== \"undefined\" && Object.prototype.toString.call(Blob) === \"[object BlobConstructor]\";\n  const withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\n  // ArrayBuffer.isView method is not defined in IE10\n  const isView = obj => {\n    return typeof ArrayBuffer.isView === \"function\" ? ArrayBuffer.isView(obj) : obj && obj.buffer instanceof ArrayBuffer;\n  };\n  const encodePacket = ({\n    type,\n    data\n  }, supportsBinary, callback) => {\n    if (withNativeBlob && data instanceof Blob) {\n      if (supportsBinary) {\n        return callback(data);\n      } else {\n        return encodeBlobAsBase64(data, callback);\n      }\n    } else if (withNativeArrayBuffer && (data instanceof ArrayBuffer || isView(data))) {\n      if (supportsBinary) {\n        return callback(data);\n      } else {\n        return encodeBlobAsBase64(new Blob([data]), callback);\n      }\n    }\n    // plain string\n    return callback(commons_js_1.PACKET_TYPES[type] + (data || \"\"));\n  };\n  exports.encodePacket = encodePacket;\n  const encodeBlobAsBase64 = (data, callback) => {\n    const fileReader = new FileReader();\n    fileReader.onload = function () {\n      const content = fileReader.result.split(\",\")[1];\n      callback(\"b\" + (content || \"\"));\n    };\n    return fileReader.readAsDataURL(data);\n  };\n  function toArray(data) {\n    if (data instanceof Uint8Array) {\n      return data;\n    } else if (data instanceof ArrayBuffer) {\n      return new Uint8Array(data);\n    } else {\n      return new Uint8Array(data.buffer, data.byteOffset, data.byteLength);\n    }\n  }\n  let TEXT_ENCODER;\n  function encodePacketToBinary(packet, callback) {\n    if (withNativeBlob && packet.data instanceof Blob) {\n      return packet.data.arrayBuffer().then(toArray).then(callback);\n    } else if (withNativeArrayBuffer && (packet.data instanceof ArrayBuffer || isView(packet.data))) {\n      return callback(toArray(packet.data));\n    }\n    encodePacket(packet, false, encoded => {\n      if (!TEXT_ENCODER) {\n        TEXT_ENCODER = new TextEncoder();\n      }\n      callback(TEXT_ENCODER.encode(encoded));\n    });\n  }\n});","lineCount":68,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"encodePacket"],[7,22,3,20],[7,25,3,23],[7,30,3,28],[7,31,3,29],[8,2,4,0,"exports"],[8,9,4,7],[8,10,4,8,"encodePacketToBinary"],[8,30,4,28],[8,33,4,31,"encodePacketToBinary"],[8,53,4,51],[9,2,5,0],[9,8,5,6,"commons_js_1"],[9,20,5,18],[9,23,5,21,"require"],[9,30,5,28],[9,31,5,28,"_dependencyMap"],[9,45,5,28],[9,64,5,43],[9,65,5,44],[10,2,6,0],[10,8,6,6,"withNativeBlob"],[10,22,6,20],[10,25,6,23],[10,32,6,30,"Blob"],[10,36,6,34],[10,41,6,39],[10,51,6,49],[10,55,7,5],[10,62,7,12,"Blob"],[10,66,7,16],[10,71,7,21],[10,82,7,32],[10,86,8,8,"Object"],[10,92,8,14],[10,93,8,15,"prototype"],[10,102,8,24],[10,103,8,25,"toString"],[10,111,8,33],[10,112,8,34,"call"],[10,116,8,38],[10,117,8,39,"Blob"],[10,121,8,43],[10,122,8,44],[10,127,8,49],[10,153,8,76],[11,2,9,0],[11,8,9,6,"withNativeArrayBuffer"],[11,29,9,27],[11,32,9,30],[11,39,9,37,"ArrayBuffer"],[11,50,9,48],[11,55,9,53],[11,65,9,63],[12,2,10,0],[13,2,11,0],[13,8,11,6,"isView"],[13,14,11,12],[13,17,11,16,"obj"],[13,20,11,19],[13,24,11,24],[14,4,12,4],[14,11,12,11],[14,18,12,18,"ArrayBuffer"],[14,29,12,29],[14,30,12,30,"isView"],[14,36,12,36],[14,41,12,41],[14,51,12,51],[14,54,13,10,"ArrayBuffer"],[14,65,13,21],[14,66,13,22,"isView"],[14,72,13,28],[14,73,13,29,"obj"],[14,76,13,32],[14,77,13,33],[14,80,14,10,"obj"],[14,83,14,13],[14,87,14,17,"obj"],[14,90,14,20],[14,91,14,21,"buffer"],[14,97,14,27],[14,109,14,39,"ArrayBuffer"],[14,120,14,50],[15,2,15,0],[15,3,15,1],[16,2,16,0],[16,8,16,6,"encodePacket"],[16,20,16,18],[16,23,16,21,"encodePacket"],[16,24,16,22],[17,4,16,24,"type"],[17,8,16,28],[18,4,16,30,"data"],[19,2,16,35],[19,3,16,36],[19,5,16,38,"supportsBinary"],[19,19,16,52],[19,21,16,54,"callback"],[19,29,16,62],[19,34,16,67],[20,4,17,4],[20,8,17,8,"withNativeBlob"],[20,22,17,22],[20,26,17,26,"data"],[20,30,17,30],[20,42,17,42,"Blob"],[20,46,17,46],[20,48,17,48],[21,6,18,8],[21,10,18,12,"supportsBinary"],[21,24,18,26],[21,26,18,28],[22,8,19,12],[22,15,19,19,"callback"],[22,23,19,27],[22,24,19,28,"data"],[22,28,19,32],[22,29,19,33],[23,6,20,8],[23,7,20,9],[23,13,21,13],[24,8,22,12],[24,15,22,19,"encodeBlobAsBase64"],[24,33,22,37],[24,34,22,38,"data"],[24,38,22,42],[24,40,22,44,"callback"],[24,48,22,52],[24,49,22,53],[25,6,23,8],[26,4,24,4],[26,5,24,5],[26,11,25,9],[26,15,25,13,"withNativeArrayBuffer"],[26,36,25,34],[26,41,26,9,"data"],[26,45,26,13],[26,57,26,25,"ArrayBuffer"],[26,68,26,36],[26,72,26,40,"isView"],[26,78,26,46],[26,79,26,47,"data"],[26,83,26,51],[26,84,26,52],[26,85,26,53],[26,87,26,55],[27,6,27,8],[27,10,27,12,"supportsBinary"],[27,24,27,26],[27,26,27,28],[28,8,28,12],[28,15,28,19,"callback"],[28,23,28,27],[28,24,28,28,"data"],[28,28,28,32],[28,29,28,33],[29,6,29,8],[29,7,29,9],[29,13,30,13],[30,8,31,12],[30,15,31,19,"encodeBlobAsBase64"],[30,33,31,37],[30,34,31,38],[30,38,31,42,"Blob"],[30,42,31,46],[30,43,31,47],[30,44,31,48,"data"],[30,48,31,52],[30,49,31,53],[30,50,31,54],[30,52,31,56,"callback"],[30,60,31,64],[30,61,31,65],[31,6,32,8],[32,4,33,4],[33,4,34,4],[34,4,35,4],[34,11,35,11,"callback"],[34,19,35,19],[34,20,35,20,"commons_js_1"],[34,32,35,32],[34,33,35,33,"PACKET_TYPES"],[34,45,35,45],[34,46,35,46,"type"],[34,50,35,50],[34,51,35,51],[34,55,35,55,"data"],[34,59,35,59],[34,63,35,63],[34,65,35,65],[34,66,35,66],[34,67,35,67],[35,2,36,0],[35,3,36,1],[36,2,37,0,"exports"],[36,9,37,7],[36,10,37,8,"encodePacket"],[36,22,37,20],[36,25,37,23,"encodePacket"],[36,37,37,35],[37,2,38,0],[37,8,38,6,"encodeBlobAsBase64"],[37,26,38,24],[37,29,38,27,"encodeBlobAsBase64"],[37,30,38,28,"data"],[37,34,38,32],[37,36,38,34,"callback"],[37,44,38,42],[37,49,38,47],[38,4,39,4],[38,10,39,10,"fileReader"],[38,20,39,20],[38,23,39,23],[38,27,39,27,"FileReader"],[38,37,39,37],[38,38,39,38],[38,39,39,39],[39,4,40,4,"fileReader"],[39,14,40,14],[39,15,40,15,"onload"],[39,21,40,21],[39,24,40,24],[39,36,40,36],[40,6,41,8],[40,12,41,14,"content"],[40,19,41,21],[40,22,41,24,"fileReader"],[40,32,41,34],[40,33,41,35,"result"],[40,39,41,41],[40,40,41,42,"split"],[40,45,41,47],[40,46,41,48],[40,49,41,51],[40,50,41,52],[40,51,41,53],[40,52,41,54],[40,53,41,55],[41,6,42,8,"callback"],[41,14,42,16],[41,15,42,17],[41,18,42,20],[41,22,42,24,"content"],[41,29,42,31],[41,33,42,35],[41,35,42,37],[41,36,42,38],[41,37,42,39],[42,4,43,4],[42,5,43,5],[43,4,44,4],[43,11,44,11,"fileReader"],[43,21,44,21],[43,22,44,22,"readAsDataURL"],[43,35,44,35],[43,36,44,36,"data"],[43,40,44,40],[43,41,44,41],[44,2,45,0],[44,3,45,1],[45,2,46,0],[45,11,46,9,"toArray"],[45,18,46,16,"toArray"],[45,19,46,17,"data"],[45,23,46,21],[45,25,46,23],[46,4,47,4],[46,8,47,8,"data"],[46,12,47,12],[46,24,47,24,"Uint8Array"],[46,34,47,34],[46,36,47,36],[47,6,48,8],[47,13,48,15,"data"],[47,17,48,19],[48,4,49,4],[48,5,49,5],[48,11,50,9],[48,15,50,13,"data"],[48,19,50,17],[48,31,50,29,"ArrayBuffer"],[48,42,50,40],[48,44,50,42],[49,6,51,8],[49,13,51,15],[49,17,51,19,"Uint8Array"],[49,27,51,29],[49,28,51,30,"data"],[49,32,51,34],[49,33,51,35],[50,4,52,4],[50,5,52,5],[50,11,53,9],[51,6,54,8],[51,13,54,15],[51,17,54,19,"Uint8Array"],[51,27,54,29],[51,28,54,30,"data"],[51,32,54,34],[51,33,54,35,"buffer"],[51,39,54,41],[51,41,54,43,"data"],[51,45,54,47],[51,46,54,48,"byteOffset"],[51,56,54,58],[51,58,54,60,"data"],[51,62,54,64],[51,63,54,65,"byteLength"],[51,73,54,75],[51,74,54,76],[52,4,55,4],[53,2,56,0],[54,2,57,0],[54,6,57,4,"TEXT_ENCODER"],[54,18,57,16],[55,2,58,0],[55,11,58,9,"encodePacketToBinary"],[55,31,58,29,"encodePacketToBinary"],[55,32,58,30,"packet"],[55,38,58,36],[55,40,58,38,"callback"],[55,48,58,46],[55,50,58,48],[56,4,59,4],[56,8,59,8,"withNativeBlob"],[56,22,59,22],[56,26,59,26,"packet"],[56,32,59,32],[56,33,59,33,"data"],[56,37,59,37],[56,49,59,49,"Blob"],[56,53,59,53],[56,55,59,55],[57,6,60,8],[57,13,60,15,"packet"],[57,19,60,21],[57,20,60,22,"data"],[57,24,60,26],[57,25,60,27,"arrayBuffer"],[57,36,60,38],[57,37,60,39],[57,38,60,40],[57,39,60,41,"then"],[57,43,60,45],[57,44,60,46,"toArray"],[57,51,60,53],[57,52,60,54],[57,53,60,55,"then"],[57,57,60,59],[57,58,60,60,"callback"],[57,66,60,68],[57,67,60,69],[58,4,61,4],[58,5,61,5],[58,11,62,9],[58,15,62,13,"withNativeArrayBuffer"],[58,36,62,34],[58,41,63,9,"packet"],[58,47,63,15],[58,48,63,16,"data"],[58,52,63,20],[58,64,63,32,"ArrayBuffer"],[58,75,63,43],[58,79,63,47,"isView"],[58,85,63,53],[58,86,63,54,"packet"],[58,92,63,60],[58,93,63,61,"data"],[58,97,63,65],[58,98,63,66],[58,99,63,67],[58,101,63,69],[59,6,64,8],[59,13,64,15,"callback"],[59,21,64,23],[59,22,64,24,"toArray"],[59,29,64,31],[59,30,64,32,"packet"],[59,36,64,38],[59,37,64,39,"data"],[59,41,64,43],[59,42,64,44],[59,43,64,45],[60,4,65,4],[61,4,66,4,"encodePacket"],[61,16,66,16],[61,17,66,17,"packet"],[61,23,66,23],[61,25,66,25],[61,30,66,30],[61,32,66,33,"encoded"],[61,39,66,40],[61,43,66,45],[62,6,67,8],[62,10,67,12],[62,11,67,13,"TEXT_ENCODER"],[62,23,67,25],[62,25,67,27],[63,8,68,12,"TEXT_ENCODER"],[63,20,68,24],[63,23,68,27],[63,27,68,31,"TextEncoder"],[63,38,68,42],[63,39,68,43],[63,40,68,44],[64,6,69,8],[65,6,70,8,"callback"],[65,14,70,16],[65,15,70,17,"TEXT_ENCODER"],[65,27,70,29],[65,28,70,30,"encode"],[65,34,70,36],[65,35,70,37,"encoded"],[65,42,70,44],[65,43,70,45],[65,44,70,46],[66,4,71,4],[66,5,71,5],[66,6,71,6],[67,2,72,0],[68,0,72,1],[68,3]],"functionMap":{"names":["<global>","isView","encodePacket","encodeBlobAsBase64","fileReader.onload","toArray","encodePacketToBinary","encodePacket$argument_2"],"mappings":"AAA;eCU;CDI;qBEC;CFoB;2BGE;wBCE;KDG;CHE;AKC;CLU;AME;gCCQ;KDK;CNC"},"hasCjsExports":true},"type":"js/module"}]}