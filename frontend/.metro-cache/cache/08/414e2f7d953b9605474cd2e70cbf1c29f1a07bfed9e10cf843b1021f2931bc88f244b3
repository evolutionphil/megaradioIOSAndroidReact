{"dependencies":[{"name":"@babel/runtime/helpers/classCallCheck","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"yg7e6laZwmpbIvId5jovq9ugXp8=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/createClass","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"Z6pzkVZ2fvxBLkFTgVVOy4UDj30=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/callSuper","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"378KbBHdmndC3iMXZ2Ix8oB3LeE=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/inherits","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"y0uNg4LxF1CLscQChxzgo5dfjvA=","exportNames":["*"],"imports":1}},{"name":"./polling.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":21,"index":122},"end":{"line":4,"column":44,"index":145}}],"key":"5ARmW/cSyTo7fOBnPh7VTK1e8ec=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _classCallCheck = require(_dependencyMap[0]).default;\n  var _createClass = require(_dependencyMap[1]).default;\n  var _callSuper = require(_dependencyMap[2]).default;\n  var _inherits = require(_dependencyMap[3]).default;\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.Fetch = undefined;\n  var polling_js_1 = require(_dependencyMap[4]);\n  /**\n   * HTTP long-polling based on the built-in `fetch()` method.\n   *\n   * Usage: browser, Node.js (since v18), Deno, Bun\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/fetch\n   * @see https://caniuse.com/fetch\n   * @see https://nodejs.org/api/globals.html#fetch\n   */\n  var Fetch = /*#__PURE__*/function (_polling_js_1$Polling) {\n    function Fetch() {\n      _classCallCheck(this, Fetch);\n      return _callSuper(this, Fetch, arguments);\n    }\n    _inherits(Fetch, _polling_js_1$Polling);\n    return _createClass(Fetch, [{\n      key: \"doPoll\",\n      value: function doPoll() {\n        this._fetch().then(res => {\n          if (!res.ok) {\n            return this.onError(\"fetch read error\", res.status, res);\n          }\n          res.text().then(data => this.onData(data));\n        }).catch(err => {\n          this.onError(\"fetch read error\", err);\n        });\n      }\n    }, {\n      key: \"doWrite\",\n      value: function doWrite(data, callback) {\n        this._fetch(data).then(res => {\n          if (!res.ok) {\n            return this.onError(\"fetch write error\", res.status, res);\n          }\n          callback();\n        }).catch(err => {\n          this.onError(\"fetch write error\", err);\n        });\n      }\n    }, {\n      key: \"_fetch\",\n      value: function _fetch(data) {\n        var _a;\n        var isPost = data !== undefined;\n        var headers = new Headers(this.opts.extraHeaders);\n        if (isPost) {\n          headers.set(\"content-type\", \"text/plain;charset=UTF-8\");\n        }\n        (_a = this.socket._cookieJar) === null || _a === undefined ? undefined : _a.appendCookies(headers);\n        return fetch(this.uri(), {\n          method: isPost ? \"POST\" : \"GET\",\n          body: isPost ? data : null,\n          headers,\n          credentials: this.opts.withCredentials ? \"include\" : \"omit\"\n        }).then(res => {\n          var _a;\n          // @ts-ignore getSetCookie() was added in Node.js v19.7.0\n          (_a = this.socket._cookieJar) === null || _a === undefined ? undefined : _a.parseCookies(res.headers.getSetCookie());\n          return res;\n        });\n      }\n    }]);\n  }(polling_js_1.Polling);\n  exports.Fetch = Fetch;\n});","lineCount":77,"map":[[2,2,1,0],[2,14,1,12],[4,2,1,13],[4,6,1,13,"_classCallCheck"],[4,21,1,13],[4,24,1,13,"require"],[4,31,1,13],[4,32,1,13,"_dependencyMap"],[4,46,1,13],[4,51,1,13,"default"],[4,58,1,13],[5,2,1,13],[5,6,1,13,"_createClass"],[5,18,1,13],[5,21,1,13,"require"],[5,28,1,13],[5,29,1,13,"_dependencyMap"],[5,43,1,13],[5,48,1,13,"default"],[5,55,1,13],[6,2,1,13],[6,6,1,13,"_callSuper"],[6,16,1,13],[6,19,1,13,"require"],[6,26,1,13],[6,27,1,13,"_dependencyMap"],[6,41,1,13],[6,46,1,13,"default"],[6,53,1,13],[7,2,1,13],[7,6,1,13,"_inherits"],[7,15,1,13],[7,18,1,13,"require"],[7,25,1,13],[7,26,1,13,"_dependencyMap"],[7,40,1,13],[7,45,1,13,"default"],[7,52,1,13],[8,2,2,0,"Object"],[8,8,2,6],[8,9,2,7,"defineProperty"],[8,23,2,21],[8,24,2,22,"exports"],[8,31,2,29],[8,33,2,31],[8,45,2,43],[8,47,2,45],[9,4,2,47,"value"],[9,9,2,52],[9,11,2,54],[10,2,2,59],[10,3,2,60],[10,4,2,61],[11,2,3,0,"exports"],[11,9,3,7],[11,10,3,8,"Fetch"],[11,15,3,13],[11,18,3,13,"undefined"],[11,27,3,22],[12,2,4,0],[12,6,4,6,"polling_js_1"],[12,18,4,18],[12,21,4,21,"require"],[12,28,4,28],[12,29,4,28,"_dependencyMap"],[12,43,4,28],[12,46,4,43],[12,47,4,44],[13,2,5,0],[14,0,6,0],[15,0,7,0],[16,0,8,0],[17,0,9,0],[18,0,10,0],[19,0,11,0],[20,0,12,0],[21,0,13,0],[22,2,5,0],[22,6,14,6,"Fetch"],[22,11,14,11],[22,37,14,11,"_polling_js_1$Polling"],[22,58,14,11],[23,4,14,11],[23,13,14,11,"Fetch"],[23,19,14,11],[24,6,14,11,"_classCallCheck"],[24,21,14,11],[24,28,14,11,"Fetch"],[24,33,14,11],[25,6,14,11],[25,13,14,11,"_callSuper"],[25,23,14,11],[25,30,14,11,"Fetch"],[25,35,14,11],[25,37,14,11,"arguments"],[25,46,14,11],[26,4,14,11],[27,4,14,11,"_inherits"],[27,13,14,11],[27,14,14,11,"Fetch"],[27,19,14,11],[27,21,14,11,"_polling_js_1$Polling"],[27,42,14,11],[28,4,14,11],[28,11,14,11,"_createClass"],[28,23,14,11],[28,24,14,11,"Fetch"],[28,29,14,11],[29,6,14,11,"key"],[29,9,14,11],[30,6,14,11,"value"],[30,11,14,11],[30,13,15,4],[30,22,15,4,"doPoll"],[30,28,15,10,"doPoll"],[30,29,15,10],[30,31,15,13],[31,8,16,8],[31,12,16,12],[31,13,16,13,"_fetch"],[31,19,16,19],[31,20,16,20],[31,21,16,21],[31,22,17,13,"then"],[31,26,17,17],[31,27,17,19,"res"],[31,30,17,22],[31,34,17,27],[32,10,18,12],[32,14,18,16],[32,15,18,17,"res"],[32,18,18,20],[32,19,18,21,"ok"],[32,21,18,23],[32,23,18,25],[33,12,19,16],[33,19,19,23],[33,23,19,27],[33,24,19,28,"onError"],[33,31,19,35],[33,32,19,36],[33,50,19,54],[33,52,19,56,"res"],[33,55,19,59],[33,56,19,60,"status"],[33,62,19,66],[33,64,19,68,"res"],[33,67,19,71],[33,68,19,72],[34,10,20,12],[35,10,21,12,"res"],[35,13,21,15],[35,14,21,16,"text"],[35,18,21,20],[35,19,21,21],[35,20,21,22],[35,21,21,23,"then"],[35,25,21,27],[35,26,21,29,"data"],[35,30,21,33],[35,34,21,38],[35,38,21,42],[35,39,21,43,"onData"],[35,45,21,49],[35,46,21,50,"data"],[35,50,21,54],[35,51,21,55],[35,52,21,56],[36,8,22,8],[36,9,22,9],[36,10,22,10],[36,11,23,13,"catch"],[36,16,23,18],[36,17,23,20,"err"],[36,20,23,23],[36,24,23,28],[37,10,24,12],[37,14,24,16],[37,15,24,17,"onError"],[37,22,24,24],[37,23,24,25],[37,41,24,43],[37,43,24,45,"err"],[37,46,24,48],[37,47,24,49],[38,8,25,8],[38,9,25,9],[38,10,25,10],[39,6,26,4],[40,4,26,5],[41,6,26,5,"key"],[41,9,26,5],[42,6,26,5,"value"],[42,11,26,5],[42,13,27,4],[42,22,27,4,"doWrite"],[42,29,27,11,"doWrite"],[42,30,27,12,"data"],[42,34,27,16],[42,36,27,18,"callback"],[42,44,27,26],[42,46,27,28],[43,8,28,8],[43,12,28,12],[43,13,28,13,"_fetch"],[43,19,28,19],[43,20,28,20,"data"],[43,24,28,24],[43,25,28,25],[43,26,29,13,"then"],[43,30,29,17],[43,31,29,19,"res"],[43,34,29,22],[43,38,29,27],[44,10,30,12],[44,14,30,16],[44,15,30,17,"res"],[44,18,30,20],[44,19,30,21,"ok"],[44,21,30,23],[44,23,30,25],[45,12,31,16],[45,19,31,23],[45,23,31,27],[45,24,31,28,"onError"],[45,31,31,35],[45,32,31,36],[45,51,31,55],[45,53,31,57,"res"],[45,56,31,60],[45,57,31,61,"status"],[45,63,31,67],[45,65,31,69,"res"],[45,68,31,72],[45,69,31,73],[46,10,32,12],[47,10,33,12,"callback"],[47,18,33,20],[47,19,33,21],[47,20,33,22],[48,8,34,8],[48,9,34,9],[48,10,34,10],[48,11,35,13,"catch"],[48,16,35,18],[48,17,35,20,"err"],[48,20,35,23],[48,24,35,28],[49,10,36,12],[49,14,36,16],[49,15,36,17,"onError"],[49,22,36,24],[49,23,36,25],[49,42,36,44],[49,44,36,46,"err"],[49,47,36,49],[49,48,36,50],[50,8,37,8],[50,9,37,9],[50,10,37,10],[51,6,38,4],[52,4,38,5],[53,6,38,5,"key"],[53,9,38,5],[54,6,38,5,"value"],[54,11,38,5],[54,13,39,4],[54,22,39,4,"_fetch"],[54,28,39,10,"_fetch"],[54,29,39,11,"data"],[54,33,39,15],[54,35,39,17],[55,8,40,8],[55,12,40,12,"_a"],[55,14,40,14],[56,8,41,8],[56,12,41,14,"isPost"],[56,18,41,20],[56,21,41,23,"data"],[56,25,41,27],[56,30,41,32,"undefined"],[56,39,41,41],[57,8,42,8],[57,12,42,14,"headers"],[57,19,42,21],[57,22,42,24],[57,26,42,28,"Headers"],[57,33,42,35],[57,34,42,36],[57,38,42,40],[57,39,42,41,"opts"],[57,43,42,45],[57,44,42,46,"extraHeaders"],[57,56,42,58],[57,57,42,59],[58,8,43,8],[58,12,43,12,"isPost"],[58,18,43,18],[58,20,43,20],[59,10,44,12,"headers"],[59,17,44,19],[59,18,44,20,"set"],[59,21,44,23],[59,22,44,24],[59,36,44,38],[59,38,44,40],[59,64,44,66],[59,65,44,67],[60,8,45,8],[61,8,46,8],[61,9,46,9,"_a"],[61,11,46,11],[61,14,46,14],[61,18,46,18],[61,19,46,19,"socket"],[61,25,46,25],[61,26,46,26,"_cookieJar"],[61,36,46,36],[61,42,46,42],[61,46,46,46],[61,50,46,50,"_a"],[61,52,46,52],[61,57,46,52,"undefined"],[61,66,46,63],[61,69,46,63,"undefined"],[61,78,46,63],[61,81,46,75,"_a"],[61,83,46,77],[61,84,46,78,"appendCookies"],[61,97,46,91],[61,98,46,92,"headers"],[61,105,46,99],[61,106,46,100],[62,8,47,8],[62,15,47,15,"fetch"],[62,20,47,20],[62,21,47,21],[62,25,47,25],[62,26,47,26,"uri"],[62,29,47,29],[62,30,47,30],[62,31,47,31],[62,33,47,33],[63,10,48,12,"method"],[63,16,48,18],[63,18,48,20,"isPost"],[63,24,48,26],[63,27,48,29],[63,33,48,35],[63,36,48,38],[63,41,48,43],[64,10,49,12,"body"],[64,14,49,16],[64,16,49,18,"isPost"],[64,22,49,24],[64,25,49,27,"data"],[64,29,49,31],[64,32,49,34],[64,36,49,38],[65,10,50,12,"headers"],[65,17,50,19],[66,10,51,12,"credentials"],[66,21,51,23],[66,23,51,25],[66,27,51,29],[66,28,51,30,"opts"],[66,32,51,34],[66,33,51,35,"withCredentials"],[66,48,51,50],[66,51,51,53],[66,60,51,62],[66,63,51,65],[67,8,52,8],[67,9,52,9],[67,10,52,10],[67,11,52,11,"then"],[67,15,52,15],[67,16,52,17,"res"],[67,19,52,20],[67,23,52,25],[68,10,53,12],[68,14,53,16,"_a"],[68,16,53,18],[69,10,54,12],[70,10,55,12],[70,11,55,13,"_a"],[70,13,55,15],[70,16,55,18],[70,20,55,22],[70,21,55,23,"socket"],[70,27,55,29],[70,28,55,30,"_cookieJar"],[70,38,55,40],[70,44,55,46],[70,48,55,50],[70,52,55,54,"_a"],[70,54,55,56],[70,59,55,56,"undefined"],[70,68,55,67],[70,71,55,67,"undefined"],[70,80,55,67],[70,83,55,79,"_a"],[70,85,55,81],[70,86,55,82,"parseCookies"],[70,98,55,94],[70,99,55,95,"res"],[70,102,55,98],[70,103,55,99,"headers"],[70,110,55,106],[70,111,55,107,"getSetCookie"],[70,123,55,119],[70,124,55,120],[70,125,55,121],[70,126,55,122],[71,10,56,12],[71,17,56,19,"res"],[71,20,56,22],[72,8,57,8],[72,9,57,9],[72,10,57,10],[73,6,58,4],[74,4,58,5],[75,2,58,5],[75,4,14,20,"polling_js_1"],[75,16,14,32],[75,17,14,33,"Polling"],[75,24,14,40],[76,2,60,0,"exports"],[76,9,60,7],[76,10,60,8,"Fetch"],[76,15,60,13],[76,18,60,16,"Fetch"],[76,23,60,21],[77,0,60,22],[77,3]],"functionMap":{"names":["<global>","Fetch","Fetch#doPoll","_fetch.then$argument_0","res.text.then$argument_0","_fetch.then._catch$argument_0","Fetch#doWrite","Fetch#_fetch","fetch.then$argument_0"],"mappings":"AAA;ACa;ICC;kBCE;4BCI,2BD;SDC;mBGC;SHE;KDC;IKC;kBHE;SGK;mBDC;SCE;KLC;IMC;gBCa;SDK;KNC;CDC"},"hasCjsExports":true},"type":"js/module"}]}